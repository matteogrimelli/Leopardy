<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gioca - Leopardy</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
    </style>
</head>
<body class="container text-center">
    <h1 class="my-4">Gioca a Leopardy</h1>
    
    <div id="playerSelection">
        <label for="numPlayers">Numero di giocatori:</label>
        <input type="number" id="numPlayers" min="1" max="10" value="2" class="form-control w-25 mx-auto">
        <button class="btn btn-primary mt-2" onclick="setupPlayers()">Conferma</button>
    </div>
    
    <div id="fileUpload" class="hidden">
        <label for="jsonFile" class="form-label">Carica un file JSON:</label>
        <input type="file" id="jsonFile" class="form-control w-50 mx-auto" accept="application/json">
    </div>
    
    <table id="board" class="table table-bordered mt-4 hidden"></table>
    
    <div id="questionBox" class="question-box hidden"></div>
    
    <div id="scoreboard" class="scoreboard hidden"></div>
    
    <script>
        let boardData = null;
        let currentPoints = 0;
        
        function setupPlayers() {
            const numPlayers = document.getElementById("numPlayers").value;
            const scoreboard = document.getElementById("scoreboard");
            scoreboard.innerHTML = "";
            for (let i = 0; i < numPlayers; i++) {
                const playerBox = document.createElement("div");
                playerBox.className = "player-box";
                playerBox.innerHTML = `
                    <input type="text" class="form-control" value="Giocatore ${i + 1}">
                    <p class="score">0</p>
                    <button class="btn btn-success" onclick="updateScore(this, ${i}, currentPoints)">+</button>
                    <button class="btn btn-danger" onclick="updateScore(this, ${i}, -currentPoints)">-</button>
                `;
                scoreboard.appendChild(playerBox);
            }
            scoreboard.classList.remove("hidden");
            document.getElementById("fileUpload").classList.remove("hidden");
        }
        
        document.getElementById("jsonFile").addEventListener("change", function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    boardData = JSON.parse(e.target.result);
                    generateBoard();
                };
                reader.readAsText(file);
            }
        });
        
        function generateBoard() {
            const board = document.getElementById("board");
            board.innerHTML = "";
            
            let thead = document.createElement("thead");
            let headRow = document.createElement("tr");
            headRow.innerHTML = "<th></th>";
            boardData.categories.forEach(cat => {
                let th = document.createElement("th");
                th.innerText = cat;
                headRow.appendChild(th);
            });
            thead.appendChild(headRow);
            board.appendChild(thead);
            
            let tbody = document.createElement("tbody");
            boardData.rows.forEach((row, rIdx) => {
                let tr = document.createElement("tr");
                let tdPoints = document.createElement("td");
                tdPoints.innerText = row.points;
                tr.appendChild(tdPoints);
                
                row.questions.forEach((q, qIdx) => {
                    let td = document.createElement("td");
                    let btn = document.createElement("button");
                    btn.className = "btn btn-warning";
                    btn.innerText = row.points;
                    btn.onclick = function() { showQuestion(q, row.points); };
                    td.appendChild(btn);
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
            board.appendChild(tbody);
            board.classList.remove("hidden");
        }
        
        function showQuestion(questionData, points) {
            currentPoints = parseInt(points);
            const questionBox = document.getElementById("questionBox");
            questionBox.innerHTML = `<p>${questionData.question}</p>`;
            questionBox.classList.remove("hidden");
            questionBox.dataset.answer = questionData.answer;
        }
        
        document.addEventListener("keydown", function(event) {
            if (event.code === "Space") {
                const questionBox = document.getElementById("questionBox");
                if (questionBox.innerHTML.includes("<p>")) {
                    questionBox.innerHTML += `<hr><p><strong>Risposta:</strong> ${questionBox.dataset.answer}</p>`;
                }
            }
        });
        
        function updateScore(button, playerIndex, points) {
            let scoreElement = button.parentElement.querySelector(".score");
            let currentScore = parseInt(scoreElement.innerText);
            scoreElement.innerText = currentScore + points;
        }
    </script>
</body>
</html>
